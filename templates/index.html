<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Game</title>
    <!-- Telegram Web Apps JavaScript API -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* @font-face {
            font-family: 'PixelFont';
            src: url('https://example.com/path-to-your-pixel-font.ttf') format('truetype');
        } */

        body,
        html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: black;
            background-image: url("{{url_for('static', filename='img/background_index.png')}}");
            font-family: 'Avenir', sans-serif;
            font-weight: bold;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        #game-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #gameCanvas {
            display: none;
        }

        #countdown {
            font-family: 'PixelFont', sans-serif;
            font-size: 10vh;
            color: #ff00ff;
            text-align: center;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
        }

        .message {
            padding: 1vh;
            border-radius: 5px;
            width: 90vw;
            text-align: center;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 3.5vh;
            font-weight: bold;
            display: none;
        }

        #sec-label,
        #message,
        #leverage-message,
        #bull-value,
        #bear-value,
        #boost-message,
        #slowdown-message,
        #zkp-message,
        #triend-message {
            top: 30%;
        }

        #message {
            top: 35%;
        }

        #leverage-message {
            top: 40%;
        }

        #bull-value {
            top: 45%;
        }

        #bear-value {
            top: 50%;
        }

        #boost-message {
            top: 55%;
        }

        #slowdown-message {
            top: 60%;
        }

        #zkp-message {
            top: 65%;
        }

        #triend-message {
            top: 75%;
        }

        #game-over-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            color: white;
            text-align: center;
            display: none;
            background-color: black;
            padding: 2vh;
            border-radius: 10px;
        }

        #game-over {
            font-size: 5vh;
            color: red;
            padding: 2vh;
        }

        .game-stats {
            margin-top: 10px;
            font-size: 2.5vh;
            flex-grow: 1;
            overflow-y: auto;
        }

        .game-stats table {
            width: 100%;
            color: white;
            border-collapse: collapse;
        }

        .game-stats th,
        .game-stats td {
            padding: 10px;
            border: 1px solid #ddd;
        }

        .game-stats th {
            background-color: #444;
        }

        .leaderboard-container {
            margin: 0 auto;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
            text-align: center;
            padding: 20px;
            color: white;
            max-height: 60vh;
            display: flex;
            flex-direction: column;
        }

        .leaderboard-header {
            background-color: #00FFCF;
            /* Updated color */
            color: black;
            padding: 10px 0;
            border-radius: 10px 10px 0 0;
            font-size: 4vh;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .score-section {
            margin: 20px 0;
        }

        .score-section h2 {
            margin: 5px 0;
            font-size: 5vh;
            color: #00FFCF;
            /* Updated color */
        }

        .game-stats {
            margin-top: 20px;
            font-size: 3vh;
            flex-grow: 1;
            overflow: auto;
        }

        .game-stats div {
            margin: 10px 0;
        }

        .tabs {
            display: flex;
            justify-content: space-around;
            cursor: pointer;
        }

        .tab {
            flex: 1;
            padding: 10px;
            background-color: #444;
            border-radius: 10px 10px 0 0;
            font-size: 2.5vh;
            font-weight: bold;
            text-align: center;
        }

        .tab.active {
            background-color: #00FFCF;
            /* Updated color */
            color: black;
        }

        .tab-content {
            display: none;
            flex-grow: 1;
            overflow-y: auto;
        }

        .tab-content.active {
            display: block;
        }

        .buttons {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }

        .buttons button,
        .my-progress,
        .share-dropdown a {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 3vh;
            background: linear-gradient(90deg, #FF0092, #00FFCF);
            /* Linear gradient color */
            color: black;
            text-align: center;
        }

        .my-progress {
            background-color: #ADD8E6;
            color: black;
        }

        #add-points-button {
            position: relative;
            display: inline-block;
        }

        #share-dropdown {
            display: none;
            position: absolute;
            background-color: #ADD8E6;
            min-width: 160px;
            max-height: 200px;
            overflow-y: auto;
            box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
            z-index: 1;
            border-radius: 10px;
        }

        #share-dropdown a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            border-radius: 10px;
        }

        #share-dropdown a:hover {
            background-color: #f1f1f1;
        }

        #score {
            position: absolute;
            top: 2vh;
            left: 2vh;
            font-size: 3vh;
            color: white;
            text-align: left;
            width: auto;
            z-index: 10;
        }

        #score-breakdown {
            position: absolute;
            top: 11vh;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2.5vh;
            text-align: center;
            width: 90vw;
            color: white;
            z-index: 10;
        }

        #health-container {
            position: absolute;
            top: 7vh;
            left: 2vh;
            width: 15vw;
            height: 10px;
            background: url('path/to/health-bar.png') no-repeat center;
            background-size: contain;
            border-radius: 5px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            padding: 1px;
        }

        #health-bar {
            height: 100%;
            background-color: green;
            width: 100%;
            transition: width 0.5s, background-color 0.5s;
        }

        #end-and-bank-button {
            position: absolute;
            top: 2vh;
            right: 10vh;
            /* Adjusted to make space for info button */
            padding: 1vh 2vh;
            font-size: 2vh;
            background-color: red;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            z-index: 10;
        }

        #info-button {
            position: absolute;
            top: 2vh;
            right: 2vh;
            width: 5vh;
            height: 5vh;
            background: #575757;
            /* Updated color */
            color: black;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 2.5vh;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        #info-modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0, 0, 0);
            background-color: rgba(0, 0, 0, 0.8);
        }

        #info-modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            border-radius: 10px;
            font-size: 2.5vh;
            color: black;
            overflow-y: auto;
            max-height: 60vh;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        #flash-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 0, 0, 0.5);
            display: none;
            z-index: 20;
        }

        #opening-page {
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            text-align: center;
            width: 90vw;
            font-size: 3.5vh;
            font-weight: bold;
        }

        #yes-button,
        #no-button {
            padding: 1vh 2vh;
            font-size: 3vh;
            background-color: white;
            color: black;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 1vh;
            width: 40vw;
        }

        #characters {
            display: flex;
            justify-content: center;
            margin-bottom: 2vh;
        }

        #characters img {
            width: 10vw;
            height: 10vw;
            margin-right: 1vw;
        }

        #characters img:last-child {
            margin-right: 0;
        }

        /* Footer styles from tasks.html */
        .footer {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 5px 0;
            border-top: 1px solid #333;
            position: fixed;
            width: 100%;
            height: 250px;
            gap: 20px;
            border-radius: 50px 50px 0px 0px;
            opacity: 0px;
            bottom: 0px;
            background: linear-gradient(180deg, #2A3A37 0%, #000000 100%);
            box-shadow: 0px -4px 4px 0px #00FFCF;
            background-color: black;
            z-index: 1000;
        }

        /* Start Game Button */
        .start-game {
            width: 90%;
            height: 50px;
            padding: 12px 0px 0px 0px;
            border-radius: 16px 16px 16px 16px;
            font-family: Inter;
            font-size: 20px;
            font-weight: 700;
            background: #00FFCF;
            color: black;
            text-align: center;
        }

        .start-game:hover {
            opacity: 90%;
        }

        .start-game:active {
            box-shadow: 0 1px #fff;
            transform: translateY(1px);
        }
    </style>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>

<body>
    <div id="opening-page">
        <h3>WELCOME <br />TO WEN WORLD</h3>
        <div id="characters">
            <img id="good-coin-img" loading="lazy" src="{{url_for('static', filename='img/good-coin-img.png')}}"
                alt="Good Coin">
            <img id="bad-coin-img" loading="lazy" src="{{url_for('static', filename='img/bad-coin-img.png')}}"
                alt="Bad Coin">
            <img id="bull-img" loading="lazy" src="{{url_for('static', filename='img/bull-img.png')}}" alt="Bull">
            <img id="bear-img" loading="lazy" src="{{url_for('static', filename='img/bear-img.png')}}" alt="Bear">
            <img id="sam-bankman-img" loading="lazy" src="{{url_for('static', filename='img/sam-bankman-img.png')}}"
                alt="Sam Bankman">
            <img id="triend-img" loading="lazy" src="{{url_for('static', filename='img/triend-img.png')}}" alt="Triend">
            <img id="zkp-img" loading="lazy" src="{{url_for('static', filename='img/zkp-img.png')}}" alt="ZKP">
            <img id="symbol-green" loading="lazy" src="{{url_for('static', filename='img/symbol_candle_green.png')}}"
                alt="Green">
            <img id="symbol-red" loading="lazy" src="{{url_for('static', filename='img/symbol_candle_red.png')}}"
                alt="Red">
        </div>
    </div>
    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
    </div>
    <div id="countdown">3</div>
    <div class="ground" id="ground" style="display:none;"></div>
    <div id="score" style="display:none;">Score: 0</div>
    <div id="health-container" style="display:none;">
        <div id="health-bar"></div>
    </div>
    <div id="score-breakdown" style="display:none;"></div>
    <button id="end-and-bank-button" style="display:none;" onclick="endAndBank()">End and Bank</button>
    <button id="info-button">i</button>
    <div id="message" class="message" style="color: red;">Sammy just rug pulled you</div>
    <div id="leverage-message" class="message" style="color: green;">Infinite knowledge grants you +100 Triend points
    </div>
    <div id="bear-value" class="message" style="color: red;">Market maker bear has stolen your gains</div>
    <div id="boost-message" class="message" style="color: green;"> Short Squeeeeze</div>
    <div id="slowdown-message" class="message" style="color: red;">You've been stopped out</div>
    <div id="last-life-message" class="message"
        style="top: 50%; transform: translate(-50%, -50%); background-color: red; color: white;">Warning: One life
        remaining!</div>
    <div id="zkp-message" class="message" style="color: green;">Infinite knowledge grants you +100 Triend points</div>
    <div id="triend-message" class="message" style="color: green;">200 Triend points collected</div>
    <div id="game-over-screen">
        <div id="game-over" style="color: red;">Game Over</div>
        <div class="leaderboard-container">
            <div class="leaderboard-header">
                My Wen Scores
            </div>
            <div class="score-section">
                <h2 id="final-score">0</h2>
            </div>
            <div class="tabs">
                <div class="tab active" onclick="showTab('high-scores')">High Scores</div>
                <div class="tab" onclick="showTab('total-points')">Total Points</div>
            </div>
            <div class="game-stats">
                <div id="high-scores" class="tab-content active">
                    <table>
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Player</th>
                                <th>Score</th>
                            </tr>
                        </thead>
                        <tbody id="high-scores-list">
                            <!-- High scores data will be appended here -->
                        </tbody>
                    </table>
                </div>
                <div id="total-points" class="tab-content">
                    <table>
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Player</th>
                                <th>Score</th>
                            </tr>
                        </thead>
                        <tbody id="total-points-list">
                            <!-- Total points data will be appended here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="buttons">
            <div id="add-points-button" class="my-progress">Add Points
                <div id="share-dropdown" class="share-dropdown">
                    <a href="#" onclick="shareOnDiscord()">Discord</a>
                    <a href="#" onclick="shareOnTelegram()">Telegram</a>
                    <a href="#" onclick="shareOnTwitter()">Twitter</a>
                </div>
            </div>
            <button class="my-progress" onclick="restartGame()">Play Again</button>
        </div>
    </div>
    </div>
    <div id="info-modal">
        <div id="info-modal-content">
            <span class="close">&times;</span>
            <h2>üöÄ Welcome to Wen World!</h2>
            <p>Click to jump and get as high of a score as you can! Check where you stand on the leaderboard and boost
                your total score by completing tasks!</p>


            <p>üí∞Coins: +5 TP</p>
            <p>üí© Coins: -40 to +40 TP</p>
            <p>Triend token: +200 TP</p>
            <p>ZKP: +100 TP</p>
            <p>üêÇBulls: Makes all üí© Coins winners for 2 seconds!</p>
            <p>üêªBears: Spawns Sammy, takes a life, and steals 50 TP</p>
            <p>ü•∑Sammy: Steals half your TP and takes a life</p>
            <p>Red Candle: Takes a life</p>
            <p>Green Candle: Launch into the air!</p>
            <h3>‚ù§Ô∏è Keeping Your Score Safe</h3>
            <p>End and Bank: Secure your score and end the game</p>
        </div>
    </div>
    <div id="flash-screen"></div>
    <audio id="cashRegisterSound" src="https://freesound.org/data/previews/195/195138_2074484-lq.mp3"
        preload="auto"></audio>
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            console.log("DOM fully loaded and parsed");
            if (window.Telegram.WebApp) {
                Telegram.WebApp.ready();
                resizeCanvas();
            }
        });

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            if (window.Telegram.WebApp) {
                const viewportHeight = Telegram.WebApp.viewportHeight;
                const viewportStableHeight = Telegram.WebApp.viewportStableHeight;
                canvas.width = window.innerWidth;
                canvas.height = viewportHeight;
                canvas.style.marginTop = `${(window.innerHeight - viewportHeight) / 2}px`;
                canvas.style.marginLeft = `${(window.innerWidth - canvas.width) / 2}px`;
            } else {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                canvas.style.marginTop = '0';
                canvas.style.marginLeft = '0';
            }
        }

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(tabId).classList.add('active');

            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`.tab[onclick="showTab('${tabId}')"]`).classList.add('active');
        }

        window.addEventListener('resize', resizeCanvas);

        // Preload images
        const images = {
            playerImg: "https://www.dropbox.com/scl/fi/vst3f1284optolu377rk6/Add-a-subheading-5.svg?rlkey=4vvnqmxq8qjcxw29rpv9uydv2&raw=1",
            goodCoinImg: "https://www.dropbox.com/scl/fi/lpmmzradg397jl3uk0faf/Add-a-subheading-6.svg?rlkey=oyxoux29ln5qfjhm2chexir3d&raw=1",
            badCoinImg: "https://www.dropbox.com/scl/fi/ffprp1gne2k3qi9s65diq/Add-a-subheading-3.svg?rlkey=44ro7mwowu390lkjbyilkoqb8&raw=1",
            bullImg: "https://www.dropbox.com/scl/fi/dslt1d1kd7xwp6hypdgw8/.svg?rlkey=6g1snhasrq5fklpknwlsvpmes&raw=1",
            bearImg: "https://www.dropbox.com/scl/fi/73ioipk50ixg9qld604rs/Add-a-subheading-32.png?rlkey=f24ub3dcyz2wbokphi5pg2l12&raw=1",
            samBankmanImg: "https://www.dropbox.com/scl/fi/tlsn0iioa257wbtf58lso/Add-a-subheading-29.png?rlkey=vwr7rc5m23ecjcc4dk443g9h4&raw=1",
            triendImg: "https://www.dropbox.com/scl/fi/g2o9xn1qnshg54oupj38l/Add-a-subheading-7.svg?rlkey=lp9evhxzdwvxit2dik3qi0j9x&raw=1",
            zkpImg: "https://www.dropbox.com/scl/fi/4h2xc3pwt20dgcro6g9q8/Add-a-subheading-11.svg?rlkey=2se4mwne0p256k5rzh86l74zl&raw=1"
        };
        const imageElements = {};

        function preloadImages(sources, callback) {
            let loadedImages = 0;
            let numImages = 0;
            for (let src in sources) {
                numImages++;
            }
            for (let src in sources) {
                imageElements[src] = new Image();
                imageElements[src].onload = function () {
                    if (++loadedImages >= numImages) {
                        callback();
                    }
                };
                imageElements[src].src = sources[src];

                // Log any transparency issues
                imageElements[src].onerror = function () {
                    console.error(`Error loading image ${sources[src]}`);
                };
            }
        }

        preloadImages(images, function () {
            console.log("All images loaded");
        });

        const player = {
            x: 5,
            y: canvas.height - 75 - 25,
            width: 75,
            height: 75,
            speed: 3.5, // Reduced player speed by 30%
            dy: 0,
            gravity: 0.5,
            jumpPower: 12,
            jumpCount: 0,
            maxJumpCount: 4,
            health: 3, // Set to 3 lives
            visible: true
        };
        let coins = [];
        let obstacles = [];
        let platforms = [];
        let score = 0;
        let bankedScore = 0;
        let gameOver = false;
        let clouds = [];
        let currentTerrainIndex = 0;
        let coinSpawnRate = 0.25;
        let obstacleSpawnRate = 0.005;
        let platformSpawnRate = 0.001;
        let boostActive = false;
        let slowdownActive = false;
        let reducedPointsActive = false;
        let reducedPointsDuration = 5000;
        // let leaderboard = JSON.parse(localStorage.getItem('leaderboard')) || [];
        let doublePointsActive = false;
        let doubleGoodCoinSpawn = false;
        let bullTouched = false;
        let bearTouched = false;
        let lastTouchTime = 0;
        let lastHurtTime = 0;
        let todayScore = 0;
        let allTimeTopScore = 0;
        let collectingCoins = false;
        let clearingCoins = false;
        let bullhit = false;
        const debugMode = false; // Change this to true to enable hitbox visualization

        const terrains = [
            {
                background: '#87CEEB',
                ground: 'linear-gradient(to top, #1E90FF, #87CEEB)',
                generateCoins: () => Math.random() < 0.1 ? 'bad' : 'good',
                character: 'bull'
            }
        ];

        function getRandomSize(min = 50, max = 150) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        document.addEventListener('keydown', (e) => {
            if ((e.code === 'Space' || e.code === 'ArrowUp') && player.jumpCount < player.maxJumpCount) {
                player.dy = -player.jumpPower;
                player.jumpCount++;
            }
        });

        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (player.jumpCount < player.maxJumpCount) {
                player.dy = -player.jumpPower;
                player.jumpCount++;
            }
        });

        canvas.addEventListener('click', (e) => {
            const now = Date.now();
            if (now - lastTouchTime < 300) {
                if (bullTouched) {
                    activateBullEffect();
                    bullTouched = false;
                }
                if (bearTouched) {
                    activateBearEffect();
                    bearTouched = false;
                }
            }
            lastTouchTime = now;
        });

        function drawElement(ctx, x, y, width, height, type) {
            if (type === 'candleGreen') {
                drawCandle(ctx, x, y, width, height, '#228B22');
            } else if (type === 'candleRed') {
                drawCandle(ctx, x, y, width, height, '#FF4500');
            } else if (type === 'cloud') {
                drawCloudObstacle(ctx, x, y, width, height);
            } else if (type === 'bull') {
                drawBull(ctx, x, y, width, height);
            } else if (type === 'bear') {
                drawBear(ctx, x, y, width, height);
            } else if (type === 'samBankman') {
                drawSamBankman(ctx, x, y, width, height);
            } else if (type === 'triend') {
                drawTriend(ctx, x, y, width, height);
            } else if (type === 'zkp') {
                drawZKP(ctx, x, y, width, height);
            }
        }

        function drawCandle(ctx, x, y, width, height, color) {
            ctx.fillStyle = color;
            ctx.fillRect(x + width / 4, y, width / 2, height);
            ctx.beginPath();
            ctx.moveTo(x + width / 2, y);
            ctx.lineTo(x + width / 2, y - height / 2);
            ctx.stroke();
        }

        function drawCloud(ctx, x, y, width, height) {
            ctx.beginPath();
            ctx.arc(x + width / 4, y, width / 4, 0, Math.PI * 2);
            ctx.arc(x + width / 2, y - height / 4, width / 4, 0, Math.PI * 2);
            ctx.arc(x + (3 * width) / 4, y, width / 4, 0, Math.PI * 2);
            ctx.closePath();
            ctx.fillStyle = '#FFFFFF';
            ctx.fill();
        }

        function drawCloudObstacle(ctx, x, y, width, height) {
            ctx.beginPath();
            ctx.arc(x + width / 4, y, width / 4, 0, Math.PI * 2);
            ctx.arc(x + width / 2, y - height / 4, width / 4, 0, Math.PI * 2);
            ctx.arc(x + (3 * width) / 4, y, width / 4, 0, Math.PI * 2);
            ctx.closePath();
            ctx.fillStyle = '#FFFFFF';
            ctx.fill();
        }

        function drawBull(ctx, x, y, width, height) {
            ctx.drawImage(imageElements.bullImg, x, y, width, height);
        }

        function drawBear(ctx, x, y, width, height) {
            ctx.drawImage(imageElements.bearImg, x, y, width, height);
        }

        function drawSamBankman(ctx, x, y, width, height) {
            ctx.drawImage(imageElements.samBankmanImg, x, y, width, height);
        }

        function drawTriend(ctx, x, y, width, height) {
            ctx.drawImage(imageElements.triendImg, x, y, width, height);
        }

        function drawZKP(ctx, x, y, width, height) {
            ctx.drawImage(imageElements.zkpImg, x, y, width, height);
        }

        function drawRoad() {
            const roadHeight = 25;
            ctx.fillStyle = '#333';
            ctx.fillRect(0, canvas.height - roadHeight, canvas.width, roadHeight);

            const stripeWidth = 10;
            const stripeHeight = 10;
            const stripeSpacing = 20;
            ctx.fillStyle = '#FFF';

            for (let x = 0; x < canvas.width; x += stripeWidth + stripeSpacing) {
                ctx.fillRect(x, canvas.height - roadHeight / 2 - stripeHeight / 2, stripeWidth, stripeHeight);
            }
        }

        function updateScore(breakdownMessage = '') {
            document.getElementById('score').innerText = `Score: ${score + bankedScore}`;
            document.getElementById('final-score').innerText = score + bankedScore;

            const scoreBreakdownElement = document.getElementById('score-breakdown');
            if (breakdownMessage) {
                scoreBreakdownElement.innerHTML = breakdownMessage;
                scoreBreakdownElement.style.display = 'block';
                setTimeout(() => {
                    scoreBreakdownElement.style.display = 'none';
                }, 3000);
            }
        }

        function updateHealth() {
            const healthPercentage = (player.health / 3) * 100; // Adjusted for 3 lives
            document.getElementById('health-bar').style.width = healthPercentage + '%';

            const red = Math.min(255, Math.floor((1 - healthPercentage / 100) * 255));
            const green = Math.min(255, Math.floor((healthPercentage / 100) * 255));
            const color = `rgb(${red}, ${green}, 0)`;

            document.getElementById('health-bar').style.backgroundColor = color;
        }

        function showFlash() {
            const flashElement = document.getElementById('flash-screen');
            flashElement.style.display = 'block';
            setTimeout(() => {
                flashElement.style.display = 'none';
            }, 100);
        }

        function showMessage(text, duration = 3000) {
            const messageElement = document.getElementById('message');
            messageElement.innerHTML = text;
            messageElement.style.display = 'block';
            setTimeout(() => {
                messageElement.style.display = 'none';
            }, duration);
        }

        function showLastLifeMessage() {
            const lastLifeMessage = document.getElementById('last-life-message');
            lastLifeMessage.style.display = 'block';
            setTimeout(() => {
                lastLifeMessage.style.display = 'none';
            }, 3000);
        }

        function changeTerrain() {
            const newTerrain = terrains[0]; // Always use the light blue terrain
            canvas.style.background = newTerrain.background;
            document.getElementById('ground').style.background = newTerrain.ground;

            if (newTerrain.character) {
                obstacles.push({
                    x: canvas.width,
                    y: Math.random() * (canvas.height / 2),
                    width: player.width,
                    height: player.height,
                    speed: 5,
                    type: newTerrain.character
                });
            }
        }

        // Function to transform shit coins to gold coins
        function transformShitCoinsToGold() {
            coins.forEach(coin => {
                if (coin.type === 'bad') {
                    coin.type = 'good';
                }
            });
        }

        // Function to transform all coins to shit coins
        function transformCoinsToShit() {
            coins.forEach(coin => {
                coin.originalType = coin.type;
                coin.type = 'bad';
            });
        }

        // Function to revert gold coins back to shit coins after 5 seconds
        function revertGoldCoins() {
            setTimeout(() => {
                coins.forEach(coin => {
                    if (coin.type === 'good') {
                        const isGoldCoin = Math.random() < 0.1; // 10% chance to remain gold
                        coin.type = isGoldCoin ? 'good' : 'bad';
                    }
                });
                updateCoinImages();
            }, 5000);
        }

        // Function to revert coins to their original types after 5 seconds
        function revertCoins() {
            setTimeout(() => {
                coins.forEach(coin => {
                    if (coin.originalType) {
                        coin.type = coin.originalType;
                        delete coin.originalType;
                    }
                });
                updateCoinImages();
            }, 5000);
        }

        // Function to update coin images based on their type
        function updateCoinImages() {
            coins.forEach(coin => {
                coin.img = coin.type === 'good' ? imageElements.goodCoinImg : imageElements.badCoinImg;
            });
        }

        function showNegativeFlash() {
            const flashElement = document.getElementById('flash-screen');
            flashElement.style.background = 'rgba(0, 0, 0, 0.5)';
            flashElement.style.display = 'block';
            setTimeout(() => {
                flashElement.style.display = 'none';
                flashElement.style.background = 'rgba(255, 0, 0, 0.5)';
            }, 1000);
        }

        function bankCoins() {
            bankedScore += score;
            todayScore += score;
            score = 0;
            updateScore();
            showMessage("Coins banked successfully!", 2000);
        }

        // get the all the score value
        async function displayLeaderboard(leaderboard) {
            const highScorelist = document.getElementById('high-scores-list');
            const totalScorelist = document.getElementById('total-points-list');

            highScorelist.innerHTML = '';
            totalScorelist.innerHTML = '';

            await fetch('https://wen-world-test.onrender.com/api/v1/highscore_data', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
                .then(response => response.json())
                .then(data => {
                    data.sort((a, b) => b.points - a.points).forEach((entry, index) => {
                        const highlistItem = document.createElement('tr');
                        highlistItem.innerHTML = `<td>${index + 1}</td><td>${entry.name}</td><td>${entry.points}</td>`;
                        highScorelist.appendChild(highlistItem);
                    });
                })
                .catch((error) => {
                    console.error('Error:', error);
                });

            await fetch('https://wen-world-test.onrender.com/api/v1/totalscore_data', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
                .then(response => response.json())
                .then(data => {
                    data.sort((a, b) => b.points - a.points).forEach((entry, index) => {
                        const totallistItem = document.createElement('tr');
                        totallistItem.innerHTML = `<td>${index + 1}</td><td>${entry.name}</td><td>${entry.total}</td>`;
                        totalScorelist.appendChild(totallistItem);
                    });
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
        }

        async function saveScore() {
            // const playerName = "matt"; 
            const user = window.Telegram.WebApp.initDataUnsafe.user;
            const user_id = user.id
            if (user) {
                // const playerName = user.username || null;

                await fetch('https://wen-world-test.onrender.com/api/v2/update_score', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 'user_id': user_id, 'score': score }),
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Success:', data);
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                    });

                await displayLeaderboard();
            }
        }

        function shareWithFriends() {
            const shareText = `I scored ${todayScore} points in this awesome game! Can you beat my score?`;
            const url = window.location.href;
            const twitterUrl = `https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}&text=${encodeURIComponent(shareText)}`;
            const discordUrl = `https://discord.com/channels/@me?url=${encodeURIComponent(url)}&text=${encodeURIComponent(shareText)}`;
            const telegramUrl = `https://t.me/share/url?url=${encodeURIComponent(url)}&text=${encodeURIComponent(shareText)}`;

            return { twitterUrl, discordUrl, telegramUrl };
        }

        function toggleDropdown() {
            const dropdown = document.getElementById('share-dropdown');
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        }

        function shareOnDiscord() {
            const { discordUrl } = shareWithFriends();
            window.open(discordUrl, 'Share on Discord', 'height=600,width=800,resizable,scrollbars');
        }

        function shareOnTelegram() {
            const { telegramUrl } = shareWithFriends();
            window.open(telegramUrl, 'Share on Telegram', 'height=600,width=800,resizable,scrollbars');
        }

        function shareOnTwitter() {
            const { twitterUrl } = shareWithFriends();
            window.open(twitterUrl, 'Share on Twitter', 'height=600,width=800,resizable,scrollbars');
        }

        // function hideNavigationBar() {
        //     document.getElementById('navigation-bar').style.display = 'none';
        // }

        // function showNavigationBar() {
        //     document.getElementById('navigation-bar').style.display = 'flex';
        // }

        function startGame() {
            document.getElementById('opening-page').style.display = 'none';
            document.getElementById('gameCanvas').style.display = 'block';
            document.getElementById('ground').style.display = 'block';
            document.getElementById('score').style.display = 'block';
            document.getElementById('score-breakdown').style.display = 'block';
            document.getElementById('health-container').style.display = 'flex';
            document.getElementById('end-and-bank-button').style.display = 'block';
            // hideNavigationBar();  // Hide the navigation bar when the game starts
            resizeCanvas();
            changeTerrain(); // Set the initial terrain
            resetScores();
            lastTime = performance.now();
            gameLoop(lastTime);
        }

        function resetScores() {
            score = 0;
            bankedScore = 0;
            todayScore = 0;
            updateScore();
        }

        function showNoMessage() {
            alert("You chose not to enter the world of wen. The game will not start.");
        }

        function startCountdown() {
            document.getElementById('opening-page').style.display = 'none';
            document.getElementById('footer').style.display = 'none';
            const countdownElement = document.getElementById('countdown');
            countdownElement.style.display = 'block';
            let countdown = 3;
            countdownElement.innerHTML = countdown;
            const interval = setInterval(() => {
                countdown--;
                if (countdown > 0) {
                    countdownElement.innerHTML = countdown;
                } else if (countdown === 0) {
                    countdownElement.innerHTML = 'GO!';
                } else {
                    clearInterval(interval);
                    countdownElement.style.display = 'none';
                    startGame();
                }
            }, 1000);
        }

        function restartGame() {
            resetScores();
            player.x = 5;
            player.y = canvas.height - 75 - 25;
            player.dy = 0;
            player.jumpCount = 0;
            player.health = 3; // Set to 3 lives
            player.visible = true;

            coins = [];
            obstacles = [];
            platforms = [];
            score = 0;
            bankedScore = 0;
            gameOver = false;
            clouds = [];
            currentTerrainIndex = 0;
            coinSpawnRate = 0.25;
            obstacleSpawnRate = 0.005;
            platformSpawnRate = 0.001;
            boostActive = false;
            slowdownActive = false;
            reducedPointsActive = false;
            doublePointsActive = false;
            doubleGoodCoinSpawn = false;
            bullTouched = false;
            bearTouched = false;
            lastTouchTime = 0;
            lastHurtTime = 0;

            document.getElementById('game-over-screen').style.display = 'none';
            document.getElementById('score').style.display = 'block';
            document.getElementById('score-breakdown').style.display = 'block';
            document.getElementById('health-container').style.display = 'flex';
            document.getElementById('end-and-bank-button').style.display = 'block';
            hideNavigationBar();  // Hide the navigation bar when the game restarts
            changeTerrain();
            lastTime = performance.now();
            gameLoop(lastTime);
        }

        async function endAndBank() {
            bankedScore += score;
            todayScore += score;
            score = 0;
            gameOver = true;
            await saveScore();

            updateScore();
            document.getElementById('final-score').innerText = todayScore;
            document.getElementById('game-over-screen').style.display = 'block';
            document.getElementById('score').style.display = 'none';
            document.getElementById('score-breakdown').style.display = 'none';
            document.getElementById('health-container').style.display = 'none';
            document.getElementById('end-and-bank-button').style.display = 'none';
            showNavigationBar();  // Show the navigation bar when the game ends
            if (todayScore > allTimeTopScore) {
                allTimeTopScore = todayScore;
            }
        }

        function drawHitbox(ctx, x, y, width, height, color = 'red') {
            if (debugMode) {
                ctx.strokeStyle = color;
                ctx.lineWidth = 2;
                ctx.strokeRect(x, y, width, height);
            }
        }

        let lastTime = performance.now();

        function gameLoop(timestamp) {
            if (gameOver) return;

            const deltaTime = (timestamp - lastTime) / 1000; // Convert to seconds
            lastTime = timestamp;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            drawRoad();

            clouds.forEach(cloud => {
                drawCloud(ctx, cloud.x, cloud.y, cloud.width, cloud.height);
                cloud.x -= cloud.speed * deltaTime * 60;

                if (cloud.x + cloud.width < 0) {
                    clouds = clouds.filter(c => c !== cloud);
                }
            });

            if (player.visible) {
                ctx.drawImage(imageElements.playerImg, player.x, player.y, player.width, player.height);
                drawHitbox(ctx, player.x, player.y, player.width, player.height); // Draw hitbox if debugMode is true
            }

            coins.forEach(coin => {
                const coinImg = coin.img || (coin.type === 'good' ? imageElements.goodCoinImg : imageElements.badCoinImg);
                const coinSize = 30;
                ctx.drawImage(coinImg, coin.x, coin.y, coinSize, coinSize);
                drawHitbox(ctx, coin.x, coin.y, coinSize, coinSize); // Draw hitbox if debugMode is true

                if (collectingCoins) {
                    const dx = coin.targetX - coin.x;
                    const dy = coin.targetY - coin.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    const speed = 5 * deltaTime * 60;
                    if (distance < speed) {
                        coin.x = coin.targetX;
                        coin.y = coin.targetY;
                    } else {
                        coin.x += (dx / distance) * speed;
                        coin.y += (dy / distance) * speed;
                    }
                } else {
                    coin.x -= coin.speed * deltaTime * 60;
                }

                if (clearingCoins) {
                    const dx = canvas.width / 2 - coin.x;
                    const dy = canvas.height / 2 - coin.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    const speed = 15 * deltaTime * 60;
                    if (distance < speed) {
                        coin.x = canvas.width / 2;
                        coin.y = canvas.height / 2;
                    } else {
                        coin.x += (dx / distance) * speed;
                        coin.y += (dy / distance) * speed;
                    }
                }

                if (player.x < coin.x + coinSize &&
                    player.x + player.width > coin.x &&
                    player.y < coin.y + coinSize &&
                    player.y + player.height > coin.y) {
                    console.log(`Collision detected between player and ${coin.type} coin at (${coin.x}, ${coin.y})`);
                    let breakdownMessage = '';
                    if (coin.type === 'good') {
                        score += 5;
                        cashRegisterSound.play();
                        breakdownMessage = `<span style="color:green;">5 Triend points collected</span>`;
                    } else {
                        let shitCoinPoints = Math.floor(Math.random() * 81) - 40; // -40 to +40 points for shit coins

                        if (bullhit) shitCoinPoints = Math.abs(shitCoinPoints);
                        score += shitCoinPoints;

                        if (score < 0) score = 0;
                        breakdownMessage = `<span style="${shitCoinPoints < 0 ? 'color:red;' : 'color:green;'}">${shitCoinPoints} Triend points collected</span>`;
                    }
                    updateScore(breakdownMessage);
                    coins = coins.filter(c => c !== coin);
                }
            });

            obstacles.forEach(obstacle => {
                drawElement(ctx, obstacle.x, obstacle.y, obstacle.width, obstacle.height, obstacle.type);
                drawHitbox(ctx, obstacle.x, obstacle.y, obstacle.width, obstacle.height); // Draw hitbox if debugMode is true
                obstacle.x -= obstacle.speed * deltaTime * 60;

                // Check for collision with bull
                if (obstacle.type === 'bull' &&
                    player.x < obstacle.x + obstacle.width &&
                    player.x + player.width > obstacle.x &&
                    player.y < obstacle.y + obstacle.height &&
                    player.y + player.height > obstacle.y) {
                    console.log(`Collision detected between player and ${obstacle.type} obstacle at (${obstacle.x}, ${obstacle.y})`);
                    showMessage('<span style="color:green;">This Ones For Retail</span>');
                    obstacles = obstacles.filter(o => o !== obstacle);

                    // for 2 seconds +shitcoin
                    bullhit = true;

                    setTimeout(() => {
                        bullhit = false;
                    }, 2000);
                }

                // Check for collision with bear
                if (obstacle.type === 'bear' &&
                    player.x < obstacle.x + obstacle.width &&
                    player.x + player.width > obstacle.x &&
                    player.y < obstacle.y + obstacle.height &&
                    player.y + player.height > obstacle.y) {
                    console.log(`Collision detected between player and ${obstacle.type} obstacle at (${obstacle.x}, ${obstacle.y})`);
                    showMessage('<span style="color:red;">Market Maker Bear Has Stolen Your Gains</span>');
                    obstacles = obstacles.filter(o => o !== obstacle);
                    //actions
                    score = score - 50;
                    if (score < 0) score = 0;

                    for (let i = 0; i < 4; i++) {
                        obstacles.push({
                            x: Math.random() * (canvas.width - 200),
                            y: Math.random() * (canvas.height - 200),
                            width: player.width,
                            height: player.height,
                            speed: 5,
                            type: 'samBankman'
                        });
                    }
                }

                // Check for collision with Sam Bankman
                if (obstacle.type === 'samBankman' &&
                    player.x < obstacle.x + obstacle.width &&
                    player.x + player.width > obstacle.x &&
                    player.y < obstacle.y + obstacle.height &&
                    player.y + player.height > obstacle.y) {
                    console.log(`Collision detected between player and ${obstacle.type} obstacle at (${obstacle.x}, ${obstacle.y})`);
                    score = Math.floor(score / 2); // Halve the score
                    player.health--; // Reduce one life
                    showMessage('<span style="color:red;">Sammy just rug pulled you</span>');
                    obstacles = obstacles.filter(o => o !== obstacle);
                    updateScore();
                    updateHealth();
                    if (player.health === 1) {
                        showLastLifeMessage();
                    }
                    if (player.health <= 0) {
                        gameOver = true;
                        saveScore();
                        document.getElementById('game-over-screen').style.display = 'block';
                        document.getElementById('score').style.display = 'none';
                        document.getElementById('score-breakdown').style.display = 'none';
                        document.getElementById('health-container').style.display = 'none';
                        document.getElementById('end-and-bank-button').style.display = 'none';
                        showNavigationBar();  // Show the navigation bar when the game ends
                        if (todayScore > allTimeTopScore) {
                            allTimeTopScore = todayScore;
                        }
                        return;
                    }
                }

                // Handle other obstacles (e.g., candles, etc.)
                if (obstacle.type === 'candleGreen' &&
                    player.x < obstacle.x + obstacle.width &&
                    player.x + player.width > obstacle.x &&
                    player.y < obstacle.y + obstacle.height &&
                    player.y + player.height > obstacle.y) {
                    showBoostMessage();
                    player.dy = -player.jumpPower * 2;
                    obstacles = obstacles.filter(o => o !== obstacle);
                }

                if (obstacle.type === 'candleRed' &&
                    player.x < obstacle.x + obstacle.width &&
                    player.x + player.width > obstacle.x &&
                    player.y < obstacle.y + obstacle.height &&
                    player.y + player.height > obstacle.y) {
                    showSlowdownMessage();
                    player.dy = player.jumpPower * 2;
                    player.visible = false;
                    showFlash();
                    setTimeout(() => {
                        player.visible = true;
                        player.y = canvas.height - player.height - 25;
                        player.dy = 0;
                        updateHealth();
                    }, 1000);
                    obstacle.y = canvas.height + 100;
                    setTimeout(() => {
                        obstacles = obstacles.filter(o => o !== obstacle);
                    }, 500);
                    const now = Date.now();
                    if (now - lastHurtTime > 3000) {
                        player.health--;
                        lastHurtTime = now;
                        if (player.health === 1) {
                            showLastLifeMessage();
                        }
                        if (player.health <= 0) {
                            gameOver = true;
                            document.getElementById('game-over-screen').style.display = 'block';
                            document.getElementById('score').style.display = 'none';
                            document.getElementById('score-breakdown').style.display = 'none';
                            document.getElementById('health-container').style.display = 'none';
                            document.getElementById('end-and-bank-button').style.display = 'none';
                            showNavigationBar();  // Show the navigation bar when the game ends
                            if (todayScore > allTimeTopScore) {
                                allTimeTopScore = todayScore;
                            }
                            saveScore();
                            return;
                        }
                        showFlash();
                        updateHealth();
                    }
                }

                if (obstacle.type !== 'bull' && obstacle.type !== 'bear' && obstacle.type !== 'cloud' &&
                    player.x < obstacle.x + obstacle.width &&
                    player.x + player.width > obstacle.x &&
                    player.y < obstacle.y + obstacle.height &&
                    player.y + player.height > obstacle.y) {
                    const now = Date.now();
                    if (now - lastHurtTime > 3000) {
                        if (obstacle.type === 'triend') {
                            score += 200; // +200 points for Triend
                            updateScore(`<span style="color:green;">200 Triend points collected</span>`);
                            const triendMessage = document.getElementById('triend-message');
                            triendMessage.style.display = 'block';
                            setTimeout(() => {
                                triendMessage.style.display = 'none';
                            }, 3000);
                            obstacles = obstacles.filter(o => o !== obstacle);
                        } else if (obstacle.type === 'zkp') {
                            score += 100; // +100 points for ZKP
                            updateScore(`<span style="color:green;">Infinite knowledge grants you +100 Triend points</span>`);
                            const zkpMessage = document.getElementById('zkp-message');
                            zkpMessage.style.display = 'block';
                            setTimeout(() => {
                                zkpMessage.style.display = 'none';
                            }, 3000);
                            obstacles = obstacles.filter(o => o !== obstacle);
                        }
                    }
                }
            });

            platforms.forEach(platform => {
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
                drawHitbox(ctx, platform.x, platform.y, platform.width, platform.height); // Draw hitbox if debugMode is true
                platform.x -= platform.speed * deltaTime * 60;

                if (platform.x + platform.width < 0) {
                    platforms = platforms.filter(p => p !== platform);
                }

                if (player.x < platform.x + platform.width &&
                    player.x + player.width > platform.x &&
                    player.y < platform.y + platform.height &&
                    player.y + player.height > platform.y) {
                    player.y = platform.y - player.height;
                    player.dy = 0;
                    player.jumpCount = 0;
                }
            });

            player.dy += player.gravity * deltaTime * 60;
            player.y += player.dy * deltaTime * 60;

            if (player.y + player.height > canvas.height - 25) {
                player.y = canvas.height - player.height - 25;
                player.jumpCount = 0;
            }
            if (player.y < 0) {
                player.y = 0;
                player.dy = 0;
            }

            if (player.x < 0) {
                player.x = 0;
            }
            if (player.x + player.width > canvas.width) {
                player.x = canvas.width - player.width;
            }

            if (Math.random() < coinSpawnRate * deltaTime * 60) {
                const coinType = doubleGoodCoinSpawn ? 'good' : Math.random() < 0.1 ? 'bad' : 'good';
                coins.push({
                    x: canvas.width,
                    y: Math.random() * (canvas.height - 200),
                    size: 20,
                    speed: 5,
                    type: coinType
                });
            }

            const baseGoldTokenProbability = 0.1; // 10%

            const shitCoinProbability = baseGoldTokenProbability; // 10%
            const triendProbability = baseGoldTokenProbability * 0.01; // 0.1%
            const zkpProbability = baseGoldTokenProbability * 0.02; // 0.2%
            const bullProbability = baseGoldTokenProbability * 0.01; // 0.1%
            const bearProbability = baseGoldTokenProbability * 0.02; // 0.2%
            const greenCandleProbability = baseGoldTokenProbability * (1 / 120); // 0.083%
            const redCandleProbability = baseGoldTokenProbability * 0.01; // 0.1%
            const samBankmanProbability = baseGoldTokenProbability * (1 / 60); // 0.167%

            if (Math.random() < baseGoldTokenProbability * deltaTime * 60) {
                coins.push({
                    x: canvas.width,
                    y: Math.random() * (canvas.height - 200),
                    size: 20,
                    speed: 5,
                    type: 'good'
                });
            }

            if (Math.random() < shitCoinProbability * deltaTime * 60) {
                coins.push({
                    x: canvas.width,
                    y: Math.random() * (canvas.height - 200),
                    size: 40,
                    speed: 5,
                    type: 'bad'
                });
            }

            if (Math.random() < triendProbability * deltaTime * 60) {
                obstacles.push({
                    x: canvas.width,
                    y: Math.random() * (canvas.height - 200),
                    width: player.width,
                    height: player.height,
                    speed: 5,
                    type: 'triend'
                });
            }

            if (Math.random() < zkpProbability * deltaTime * 60) {
                obstacles.push({
                    x: canvas.width,
                    y: Math.random() * (canvas.height - 200),
                    width: player.width,
                    height: player.height,
                    speed: 5,
                    type: 'zkp'
                });
            }

            if (Math.random() < bullProbability * deltaTime * 60) {
                obstacles.push({
                    x: canvas.width,
                    y: Math.random() * (canvas.height - 200),
                    width: player.width,
                    height: player.height,
                    speed: 5,
                    type: 'bull'
                });
            }

            if (Math.random() < bearProbability * deltaTime * 60) {
                obstacles.push({
                    x: canvas.width,
                    y: Math.random() * (canvas.height - 200),
                    width: player.width,
                    height: player.height,
                    speed: 5,
                    type: 'bear'
                });
            }

            if (Math.random() < greenCandleProbability * deltaTime * 60) {
                obstacles.push({
                    x: canvas.width,
                    y: canvas.height - 25 - player.height, // on the road
                    width: player.width,
                    height: player.height,
                    speed: 5,
                    type: 'candleGreen'
                });
            }

            if (Math.random() < redCandleProbability * deltaTime * 60) {
                obstacles.push({
                    x: canvas.width,
                    y: canvas.height - 25 - player.height, // on the road
                    width: player.width,
                    height: player.height,
                    speed: 5,
                    type: 'candleRed'
                });
            }

            if (Math.random() < samBankmanProbability * deltaTime * 60) {
                obstacles.push({
                    x: canvas.width,
                    y: Math.random() * (canvas.height - 200),
                    width: player.width,
                    height: player.height,
                    speed: 5,
                    type: 'samBankman'
                });
            }

            if (Math.random() < platformSpawnRate * deltaTime * 60) {
                const platformWidth = getRandomSize(100, 200);
                platforms.push({
                    x: canvas.width,
                    y: Math.random() * (canvas.height / 2),
                    width: platformWidth,
                    height: 20,
                    speed: 5
                });
            }

            if (Math.random() < 0.01 * deltaTime * 60) {
                clouds.push({
                    x: canvas.width,
                    y: Math.random() * (canvas.height / 2),
                    width: 100,
                    height: 50,
                    speed: 2
                });
            }

            requestAnimationFrame(gameLoop);
        }

        function showBoostMessage() {
            const boostMessage = document.getElementById('boost-message');
            boostMessage.style.display = 'block';
            setTimeout(() => {
                boostMessage.style.display = 'none';
            }, 2000);
        }

        function showSlowdownMessage() {
            const slowdownMessage = document.getElementById('slowdown-message');
            slowdownMessage.style.display = 'block';

            setTimeout(() => {
                slowdownMessage.style.display = 'none';
            }, 2000);
        }

        // displayLeaderboard();

        window.onclick = function (event) {
            if (!event.target.matches('#add-points-button') && !event.target.closest('#share-dropdown')) {
                const dropdowns = document.getElementsByClassName("share-dropdown");
                for (let i = 0; i < dropdowns.length; i++) {
                    const openDropdown = dropdowns[i];
                    if (openDropdown.style.display === 'block') {
                        openDropdown.style.display = 'none';
                    }
                }
            }
        }

        // Function to highlight the active page in the navigation bar
        function highlightCurrentPage() {
            const navItems = document.querySelectorAll('.footer .footer-item');
            const currentPage = window.location.pathname;

            navItems.forEach(item => {
                const itemPage = item.getAttribute('onclick').match(/navigateTo\('(.*)'\)/)[1];
                if ((itemPage === '' && currentPage === '/') || currentPage.includes(itemPage)) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
        }

        // Call the function on page load
        highlightCurrentPage();

        // Info modal script
        const infoButton = document.getElementById("info-button");
        const infoModal = document.getElementById("info-modal");
        const closeSpan = document.getElementsByClassName("close")[0];

        infoButton.onclick = function () {
            infoModal.style.display = "block";
        }

        closeSpan.onclick = function () {
            infoModal.style.display = "none";
        }

        window.onclick = function (event) {
            if (event.target === infoModal) {
                infoModal.style.display = "none";
            }
        }
    </script>

    <div class="footer" id="footer">
        <div
            style="display: flex; align-items: center; justify-content: center; gap: 15px; margin-left: 10px; margin-right: 10px;">
            <img id="player-img" loading="lazy" src="{{url_for('static', filename='img/player-img.png')}}" alt="Player"
                width="120px" height="120px">
            <p style="font-family: Inter;
            font-size: 20px;
            line-height: 2rem;
            font-weight: 400;
            color: white;
            text-align: left;
            ">Welcome! Play to earn points. Tap to jump and get as high score as you can.</p>
        </div>
        <button class="start-game" onclick="startCountdown()">ENTER WEN WORLD</button>
    </div>
</body>

</html>